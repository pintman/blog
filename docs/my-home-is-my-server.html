<!DOCTYPE html>
<html lang="de">
<head>
        <meta charset="utf-8" />
        <title>My Home Is My Server</title>
        <link rel="stylesheet" href="https://blog.bakera.de/theme/css/main.css" />
        <link href="https://blog.bakera.de/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="/home/bakera/blog Atom Feed" />

        <!--[if IE]>
            <script src="https://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->
</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="https://blog.bakera.de/">/home/bakera/blog </a></h1>
                <nav><ul>
                    <li><a href="https://blog.bakera.de/pages/about.html">Über</a></li>
                    <li><a href="https://blog.bakera.de/pages/impressum.html">Impressum, Datenschutz</a></li>
                    <li><a href="https://blog.bakera.de/pages/wiki.html">Wiki</a></li>
                    <li class="active"><a href="https://blog.bakera.de/category/sonstiges.html">Sonstiges</a></li>
                </ul></nav>
        </header><!-- /#banner -->
<section id="content" class="body">
  <article>
    <header>
      <h1 class="entry-title">
        <a href="https://blog.bakera.de/my-home-is-my-server.html" rel="bookmark"
           title="Permalink to My Home Is My Server">My Home Is My Server</a></h1>
    </header>

    <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2014-10-16T09:30:00+02:00">
                Published: Do 16 Oktober 2014
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="https://blog.bakera.de/author/marcobakera.html">marco.bakera</a>
        </address>
<p>In <a href="https://blog.bakera.de/category/sonstiges.html">Sonstiges</a>.</p>
<p>tags: <a href="https://blog.bakera.de/tag/cubietruck.html">Cubietruck</a> </p>
</footer><!-- /.post-info -->      <p><img alt="server20" class="alignright size-full wp-image-1455" src="images/2014/10/server20.png" style="width: 128px; height: 128px;" /></p>
<p>Die (<a class="reference external" href="http://www.bakera.de/wp/2013/05/digitale-emanzipation/">meine</a>)
digitale Emanzipation schreitet weiter voran. Nachdem ich mich in den
letzten Monaten und Jahren zunehmend von den Diensten großer Unternehmen
wie Google unabhängig gemacht habe, betrete ich nun einen weiteren
Bereich der Unabhängigkeit: ein eigener Server.</p>
<div class="section" id="die-hardware">
<h2>Die Hardware</h2>
<p>Der erste Server, mit dem ich es probiert habe, war ein RaspberryPI.
Dieser hat seinen Dienst auch schon ganz gut geleistet - für einfach
Aufgaben ist ein Pi ausreichend. Beim Betrieb eines Webservers mit
PHP-Unterstützung und einer MySQL-Datenbank kommt er jedoch schnell an
seine Grenzen und wird verdammt langsam.</p>
<p>Es musste eine schnellere CPU her. Bei der zweiten Generation fiel die
Wahl auf den <a class="reference external" href="http://cubieboard.org/">Cubietruck</a> (Cubieboard 3) -
eine gute Kombination aus Rechenpower und Stromverbrauch. Dieser findet
seinen Platz in einem schönen
<a class="reference external" href="http://cubieboard.org/2014/02/27/ewell-has-come-minipc-not-be-far-behind/">Gehäuse</a>
unter dem Schreibtisch. Mit der Erweiterung um eine 128 GB große SDD
werkelt er nun flott und lautlos. In dieser Konfiguration fluppt die
Kiste zügig und ist in der Lage, meine Webseite, dieses Blog, ein
MediaWiki und eine Owncloud auszuliefern.</p>
<p>Als Betriebssystem kommt eine Server-Variante von Lubuntu für
ARM-Prozessoren zum Einsatz. Die
<a class="reference external" href="http://docs.cubieboard.org/tutorials/cubietruck/start#installation">Installation</a>
ist ausführlich im Wiki des Cubietruck beschrieben.</p>
</div>
<div class="section" id="die-vernetzung">
<h2>Die Vernetzung</h2>
<p>Doch wie landet der Surfer auf der Kiste? Wenn ihr die Adresse
www.bakera.de in den Browser eingebt, wandelt sie ein DNS-Server in die
IP-Adresse meines Internetanschlusses um. Da hängt dann ein Router (z.B.
in Form einer FritzBox), der alle Anfragen abschmettert - normalerweise.
Mit einer
<a class="reference external" href="https://de.wikipedia.org/wiki/Portweiterleitung">Portweiterleitung</a>
habe ich Anfragen für HTTP und HTTPS nun auf den Cubietruck umgeleitet.
Wie das mit eurem Router funktioniert, steht im Handbuch eures Routers.</p>
<p>Woher weiß nun der DNS-Server, wie die IP-Adresse meines Rechners
lautet? Da die Adresse von meinem Internet-Provider (der Telekom)
zugewiesen wird und sich ändern kann, muss ich diese Änderung regelmäßig
prüfen. Das klappt über einen Dienst für dynamische DNS-Einträge. Früher
war DynDNS in diesem Segment Namensgeber und Marktführer. Wegen eines
uninteressantes Preismodells habe ich mich aber für den Dienst
<a class="reference external" href="http://www.afraid.org">afraid.org</a>entschieden. Er bietet kostenlos
viele Domainnamen und eine einfache Konfiguration an. Dort habe ich mir
die Adresse bakera.homenet.org gesichert. Die IP-Adresse wird dann über
den Aufruf einer Webseite regelmäßig aktualisiert. Dazu läuft im
Cubietruck ein Cronjob, der stündlich seine aktuelle IP-Adresse an
afraid,org schickt.</p>
<pre class="literal-block">
curl -k https://freedns.afraid.org/dynamic/update.php?dkgmdn53kdmgn64l3nd
</pre>
<p>Die kryptische Zeichenkette am Ende ist ein geheimer Schlüssel, der
dafür sorgt, dass nur ich den Eintrag aktualisieren kann. Natürlich habe
ich ihn in diesem Artikel geändert.</p>
<p>Liebend gern hätte ich diesen Dienst auch direkt bei meiner Adresse
www.bakera.de. Leider bietet mein Registrar HostEurope einen solchen
Dienst nicht an. Da steht demnächst also auch noch ein Wechsel ins Haus
- <a class="reference external" href="http://www.inwx.com/">InterNetworX</a> scheint einen guten und
günstigen Dienst hierfür anzubieten. Daher gehe ich im Moment einen
kleinen Umweg und habe für www.bakera.de bei HostEurope einen
<a class="reference external" href="https://de.wikipedia.org/wiki/CNAME_Resource_Record">CNAME-Eintrag</a>
(eine Weiterleitung direkt im Nameserver) hinterlegt, der auf die
Adresse bei afraid.org zeigt.</p>
<p>Eine weitere spannende Alternative ist das
<a class="reference external" href="http://www.opennicproject.org/">OpenNIC-Projekt</a>. Es betreibt eigene
Nameserver und vergibt kostenlos eigene Adresse für Top Level Domains
wie z.B. .free .geek .null. Da die Adressen parallel zu den von der
<a class="reference external" href="https://de.wikipedia.org/wiki/Internet_Corporation_for_Assigned_Names_and_Numbers">ICANN</a>
vergebenen Adressen laufen, kann man deren Nameserver auch für das
&quot;normale&quot; Internet verwenden. Die Adressen bakera.free und bakera.geek
habe ich dort sicherheitshalber schon registriert.</p>
</div>
<div class="section" id="die-sicherheit">
<h2>Die Sicherheit</h2>
<p>Nun ist der Server erreichbar und ich kann die Inhalte abrufen. Jetzt
wird es Zeit für ein wenig Sicherheit. Die Verbindung soll durch ein
Zertifikat und eine SSL (TLS) Verbindung über HTTPS abgesichert werden.
Mann kann ein selbst-signiertes Zertifikat erstellen und für den eigenen
Webserver verwenden. Gängige Browser meckern dann jedoch, weil sie es
für keine gute Idee halten, wenn das Zertifikat nicht von einer Stelle
ausgestellt wurde, die dafür gewöhnlich Geld nimmt. Gott sei Dank gibt
es eine rühmliche Ausnahme bei den Zertifizierungstellen: <a class="reference external" href="https://www.startssl.com/">Start
SSL</a> stellt kostenlose Zertifikate aus und
wird von aktuellen Browsern als vertrauenswürdig eingestuft. Eine gute
<a class="reference external" href="http://www.heise.de/security/artikel/SSL-fuer-lau-880221.html">Anleitung bei
heise</a>
erklärt, wie es geht.</p>
<p>Damit die Daten auch nach einem Defekt oder Ausfall der Hardware
wiederherstellbar sind, muss ein Backup her. Da der Server über SSH
erreichbar ist, kann ich ein einfaches Skript schreiben, das die Daten
vom Server holt und lokal sichert. Ich hatte ein solches Skript bereits
<a class="reference external" href="http://www.bakera.de/wp/2014/09/backup-ueber-ssh-und-eine-pipe/">vorgestellt</a>.
Die Backupskripte werden auf dem Backuperechner ausgeführt und sehen
etwa wie folgt aus:</p>
<pre class="literal-block">
ssh user&#64;server &quot;mysqldump -u wiki --password=wikkipasswort wiki&quot; | gzip -c &gt; wiki.sql.gz
ssh user&#64;server &quot;php /var/www/wiki/maintenance/dumpBackup.php --full&quot; | gzip -c &gt; wiki-pages.txt.gz
ssh user&#64;server &quot;tar cf - /var/www /home/user&quot; | gzip -c &gt; files.tar.gz
</pre>
<p>Für ein aktuelles Backup der Dateien bietet sich auch rsync an, das auf
dem Backuprechner ausgeführt wird. Das läuft für gewöhnlich schneller,
da rsync nur Daten überträgt, die sich seit dem letzten Lauf geändert
haben.</p>
<pre class="literal-block">
rsync -av user&#64;server:/home/user files
rsync -av user&#64;server:/var/www file
</pre>
<p>Zu guter Letzt habe ich mir angewöhnt, alle Dinge, die ich an der
Konfiguration oder Installation ändere, in einer Textdatei auf dem
Server abzuspeichern. So habe ich immer einen Überblick darüber, was
gemacht wurde oder später erneut gemacht werden muss, wenn der Server
einmal neu aufgesetzt wird.</p>
<p>Nun liegen die Daten direkt bei mir unter dem Schreibtisch und ich habe
die vollständige Kontrolle über den Server. Ein gutes Gefühl.</p>
</div>

    </div><!-- /.entry-content -->

  </article>
</section>
        <section id="extras" class="body">
                <div class="social">
                        <h2>social</h2>
                        <ul>
                            <li><a href="https://blog.bakera.de/feeds/all.atom.xml" type="application/atom+xml" rel="alternate">atom feed</a></li>

                        </ul>
                </div><!-- /.social -->
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a href="http://getpelican.com/">Pelican</a>, which takes great advantage of <a href="http://python.org">Python</a>.
                </address><!-- /#about -->

                <p>The theme is by <a href="http://coding.smashingmagazine.com/2009/08/04/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
        </footer><!-- /#contentinfo -->

</body>
</html>